// enable TTL on the TodoReminders table for the RemindAtEpoch attribute
aws dynamodb update-time-to-live --table-name TodoReminders --time-to-live-specification "Enabled=true, AttributeName=RemindAtEpoch" --endpoint-url http://localhost:4566 --profile localstack

// enable streams on the TodoReminders table with NEW_AND_OLD_IMAGES view type
aws dynamodb update-table --table-name TodoReminders --stream-specification StreamEnabled=true,StreamViewType=NEW_AND_OLD_IMAGES --endpoint-url http://localhost:4566 --profile localstack

// veryify TTL is enabled
aws dynamodb describe-time-to-live `
  --table-name TodoReminders `
  --endpoint-url http://localhost:4566 `
  --profile localstack `
  --region ap-southeast-2

// verify streams are enabled
aws dynamodb describe-table --table-name TodoReminders --endpoint-url http://localhost:4566 --profile localstack

// verify streams are enabled and get the stream ARN
aws dynamodb describe-table --table-name TodoReminders --endpoint-url http://localhost:4566 --profile localstack --query "Table.LatestStreamArn"

// verify TTL settings
aws dynamodb describe-time-to-live --table-name TodoReminders --endpoint-url http://localhost:4566 --profile localstack

// list event source mappings for the ReminderStreamLambda function
aws lambda list-event-source-mappings --function-name ReminderStreamLambda --endpoint-url http://localhost:4566 --profile localstack

// create event source mapping for the ReminderStreamLambda function
$streamArn = aws dynamodb describe-table `
  --table-name TodoReminders `
  --endpoint-url http://localhost:4566 `
  --profile localstack `
  --query "Table.LatestStreamArn" `
  --output text

aws lambda create-event-source-mapping `
  --function-name ReminderStreamLambda `
  --event-source-arn $streamArn `
  --starting-position LATEST `
  --endpoint-url http://localhost:4566 `
  --profile localstack

